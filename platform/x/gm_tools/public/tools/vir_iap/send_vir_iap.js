// Generated by CoffeeScript 1.12.7
(function() {
  var Api, InputNumber, Modal, NewSendIAPModal, React, antd;

  antd = require('antd');

  React = require('react');

  Modal = antd.Modal;

  InputNumber = antd.InputNumber;

  Api = require('../api/api_ajax');

  NewSendIAPModal = React.createClass({displayName: "NewSendIAPModal",
    getInitialState: function() {
      return {
        loading: false,
        visible: false,
        hc_add: 1,
        iap: 0
      };
    },
    showModal: function() {
      return this.setState({
        visible: true
      });
    },
    handleOk: function() {
      this.setState({
        loading: true
      });
      this.setState({
        loading: false,
        visible: false
      });
      return this.send();
    },
    handleCancel: function() {
      return this.setState({
        visible: false
      });
    },
    send: function() {
      var api;
      if (this.state.hc_add <= 0) {
        this.props.onSend();
        return;
      }
      api = new Api();
      return api.Typ("virtualIAP").ServerID(this.props.server_id).AccountID(this.props.account_id).Key(this.props.curr_key).Params(this.state.hc_add).Do((function(_this) {
        return function(result) {
          _this.setState({
            mails: JSON.parse(result),
            is_loading: false
          });
          console.log("onSend");
          return _this.props.onSend();
        };
      })(this));
    },
    handleRewardChange: function(count) {
      this.setState({
        hc_add: parseInt(count, 10)
      });
      console.log("handleRewardChange");
      return console.log(count);
    },
    handleIAPChange: function(count) {
      this.setState({
        iap: parseInt(count, 10)
      });
      console.log("handleIAP");
      return console.log(count);
    },
    render: function() {
      var base;
      return React.createElement("div", null, React.createElement(antd.Button, {
        "className": "ant-btn ant-btn-primary",
        "onClick": this.showModal
      }, this.props.modal_name), React.createElement(Modal, {
        "visible": this.state.visible,
        "title": "发送模拟充值邮件",
        "onOk": this.handleOk,
        "onCancel": this.handleCancel,
        "width": 700,
        "footer": [
          React.createElement(antd.Button, {
            "key": "back",
            "className": "ant-btn",
            "onClick": this.handleCancel
          }, "返 回"), React.createElement(antd.Button, {
            "key": "submit",
            "className": "ant-btn ant-btn-primary",
            "onClick": this.handleOk
          }, "提 交", React.createElement("i", {
            "className": 'anticon anticon-loading' + (typeof (base = this.state).loading === "function" ? base.loading({
              '': 'hide'
            }) : void 0)
          }))
        ]
      }, React.createElement("p", null, "奖励:"), React.createElement(InputNumber, {
        "min": 1,
        "max": 1000000,
        "defaultValue": 1,
        "onChange": this.handleRewardChange,
        "style": {
          width: 70
        }
      })));
    }
  });

  module.exports = NewSendIAPModal;

}).call(this);
