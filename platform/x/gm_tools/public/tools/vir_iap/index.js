// Generated by CoffeeScript 1.12.7
(function() {
  var AccountKeyInput, IAPApp, NewSendIAPModal, React, VirIAPTable, VirTrueIAP, antd;

  antd = require('antd');

  React = require('react');

  AccountKeyInput = require('../../common/account_input');

  VirIAPTable = require('./vir_iap_table');

  NewSendIAPModal = require('./send_vir_iap');

  VirTrueIAP = require('./vir_true_iap');

  IAPApp = React.createClass({displayName: "IAPApp",
    getInitialState: function() {
      return {
        select_server: this.props.curr_server,
        player_to_send: "",
        loadstat: 0
      };
    },
    enterLoading: function() {
      this.setState({
        loadstat: 1
      });
      if (this.refs.iap_table != null) {
        this.refs.iap_table.Refersh(1);
      }
      return console.log(this.state);
    },
    leaveLoading: function() {
      return this.setState({
        loadstat: 2
      });
    },
    isServerRight: function() {
      return (this.state.select_server != null) && (this.state.select_server.serverName != null);
    },
    isAccountRight: function() {
      return (this.refs.accountin != null) && this.refs.accountin.IsRight();
    },
    getLoadingState: function() {
      if (!this.isServerRight() || !this.isAccountRight()) {
        return "disabled";
      }
      if (this.state.loadstat === 1) {
        return 'ant-btn-loading';
      } else {
        return '';
      }
    },
    getIAPTable: function() {
      if (this.state.loadstat === 0) {
        return React.createElement("div", null, "点击按钮加载ID");
      }
      if (!this.isServerRight()) {
        return React.createElement("div", null, " ");
      }
      if (!this.isAccountRight()) {
        return React.createElement("div", null, " ");
      }
      return React.createElement(VirIAPTable, Object.assign({}, this.props, {
        "ref": "iap_table",
        "server_id": this.state.select_server.serverName,
        "account_id": this.state.player_to_send,
        "on_loaded": this.leaveLoading
      }));
    },
    getSendIAPModal: function() {
      if (!this.isServerRight()) {
        return React.createElement("div", null, "请选择服务器");
      }
      if (!this.isAccountRight()) {
        return React.createElement("div", null, "请输入正确的用户ID");
      }
      return React.createElement(NewSendIAPModal, Object.assign({}, this.props, {
        "modal_name": "发送虚拟充值邮件",
        "server_id": this.state.select_server.serverName,
        "account_id": this.state.player_to_send,
        "onSend": this.OnSend
      }));
    },
    getSendTrueIAPModal: function() {
      if (!this.isServerRight()) {
        return React.createElement("div", null, "请选择服务器");
      }
      if (!this.isAccountRight()) {
        return React.createElement("div", null, "请输入正确的用户ID");
      }
      return React.createElement(VirTrueIAP, Object.assign({}, this.props, {
        "modal_name": "发送真实虚拟充值邮件",
        "server_id": this.state.select_server.serverName,
        "account_id": this.state.player_to_send,
        "onSend": this.OnSend
      }));
    },
    handleServerChange: function(data) {
      console.log(data);
      this.setState({
        select_server: data
      });
      return setTimeout(this.OnSend, 100);
    },
    handleUserChange: function(data) {
      console.log(data);
      if (data === "") {
        data = "请输入玩家Id";
      }
      return this.setState({
        player_to_send: data
      });
    },
    OnSend: function() {
      return console.log("SendOver");
    },
    getServerName: function() {
      if (this.state.select_server != null) {
        return this.state.select_server.name;
      } else {
        return "";
      }
    },
    render: function() {
      return React.createElement("div", null, React.createElement(AccountKeyInput, Object.assign({}, this.props, {
        "ref": "accountin",
        "can_cb": this.handleUserChange
      })), this.getSendIAPModal(), this.getSendTrueIAPModal(), React.createElement(antd.Button, {
        "className": 'ant-btn anticon-search ant-btn-primary ' + this.getLoadingState(),
        "onClick": this.enterLoading
      }, "加载用户虚拟充值记录"), this.getIAPTable());
    }
  });

  module.exports = IAPApp;

}).call(this);
