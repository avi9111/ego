// Generated by CoffeeScript 1.12.7
(function() {
  var Api, App, CSVInput, React, antd, notification, openNotificationWithIcon;

  CSVInput = require('../../common/csv_input');

  antd = require('antd');

  notification = antd.Notification;

  Api = require('../api/api_ajax');

  React = require('react');

  openNotificationWithIcon = function(type, title, msg) {
    return notification[type]({
      message: title,
      description: msg,
      duration: 5
    });
  };

  App = React.createClass({displayName: "App",
    getInitialState: function() {
      return {
        res: [],
        csv: ""
      };
    },
    componentDidMount: function() {
      var api, res;
      api = new Api();
      res = [];
      return api.Typ("getChannelUrl").ServerID("nil").AccountID("nil").Key(this.props.curr_key).ParamArray([]).Do((function(_this) {
        return function(result) {
          console.log("onSend");
          console.log(result);
          res = JSON.parse(result);
          if (res["ret"] !== "ok") {
            return openNotificationWithIcon("error", "Error", res["ret"]);
          } else {
            return _this.setState({
              res: res,
              csv: res["csv"]
            });
          }
        };
      })(this));
    },
    handleChange: function(v, str, is_right) {
      return this.setState({
        csv: str
      });
    },
    onUpload: function() {
      var api, res;
      api = new Api();
      res = [];
      return api.Typ("updateChannelUrl").ServerID("nil").AccountID("nil").Key(this.props.curr_key).ParamArray([this.state.csv]).Do((function(_this) {
        return function(result) {
          console.log("onSend");
          return console.log(result);
        };
      })(this));
    },
    render: function() {
      return React.createElement("div", null, React.createElement(CSVInput, Object.assign({}, this.props, {
        "title": "客户端更新URL",
        "value": this.state.csv,
        "ref": "accountin",
        "can_cb": this.handleChange
      })), React.createElement("button", {
        "className": "ant-btn ant-btn-primary",
        "onClick": this.onUpload
      }, "确定并上传"));
    }
  });

  module.exports = App;

}).call(this);
