// Generated by CoffeeScript 1.12.7
(function() {
  var $, API, LoginApp, MD5, React, antd, error, message, success;

  API = require('../tools/api/api_ajax');

  MD5 = require('md5');

  React = require('react');

  $ = require('jquery');

  antd = require('antd');

  message = antd.message;

  success = function() {
    return message.success('登陆成功');
  };

  error = function(msg) {
    return message.error('登陆失败:' + msg);
  };

  LoginApp = React.createClass({displayName: "LoginApp",
    getInitialState: function() {
      return {
        name: "",
        passwd: ""
      };
    },
    handleNameChange: function(event) {
      var date;
      date = event.target.value;
      return this.setState({
        name: date
      });
    },
    handlePassChange: function(event) {
      var date;
      date = event.target.value;
      return this.setState({
        passwd: date
      });
    },
    OnLogin: function() {
      var name, passwd, self;
      self = this;
      name = self.state.name;
      passwd = self.state.passwd;
      console.log(self);
      if (name === "" || passwd === "") {
        return;
      }
      return $.ajax({
        url: "../api/v1/login/" + name,
        dataType: "json",
        type: "POST",
        data: JSON.stringify({
          "n": self.mkPw(passwd)
        }),

        contentType: "application/json; charset=utf-8",
        complete: function(xhr, status) {
          var rc;
          rc = {
            status: xhr.status,
            json: xhr.responseJSON
          };

          console.log(xhr);
          console.log(status);
          if (xhr.status === 200) {
            success();
            console.log(xhr.responseText);
            return self.props.onChange(xhr.responseText);
          } else {
            return error(xhr.responseText);
          }
        }

      });



    },
    mkPw: function(passwd) {
      return MD5(MD5(passwd) + "ta1hehud0ng");
    },
    render: function() {
      return React.createElement("div", null, React.createElement("hr", null), React.createElement("div", null, "姓名:"), React.createElement("input", {
        "className": "ant-input",
        "value": this.state.priority,
        "onChange": this.handleNameChange
      }), React.createElement("div", null, "密码:"), React.createElement("input", {
        "className": "ant-input",
        "type": "password",
        "value": this.state.priority,
        "onChange": this.handlePassChange
      }), React.createElement("button", {
        "key": "submit",
        "className": "ant-btn ant-btn-primary",
        "onClick": this.OnLogin
      }, "提 交"), React.createElement("hr", null));
    }
  });

  module.exports = LoginApp;

}).call(this);
